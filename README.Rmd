---
title: "Application Exercise 2 - Air Quality Data"
output: github_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load-libraries, echo=FALSE}

library(readr)
library(ggplot2)
library(dplyr)
library(DT)
library(lubridate)

```

This exercise is part of workshops, undergraduate and graduate courses taught by the Global Health Engineering Group at ETH Zurich.

# Data

```{r read-data}

dat_link <- "https://raw.githubusercontent.com/Global-Health-Engineering/manuscript-hospital-air-quality/main/data/intermediate/malawi-hospitals-air-quality.csv"

dat_in <- read_csv(dat_link)

# Create a vector of hospital locations

vec_hospital_name <- dat_in %>% 
  count(location) %>% 
  pull(location)

```

The data used in this exercise comes from a study implemented by [\@Authors_Manuscript\_\_Malawi_2021]. Air quality data (PM2.5 and PM10) was collected in roughly 5-minute intervals from eight locations at a hospital in Blantyre, Malawi over the period of 3 months. The locations are `r knitr::combine_words(vec_hospital_name)`.

The data has six variables as described in the table below and about 200'000 measurements.

| variable_name | description                                              | data_type           | units |
|---------------|----------------------------------------------------------|---------------------|-------|
| date_time     | Date and time of measurement                             | POSIXct (date_time) | NA    |
| id            | A running id for the different locations at the hospital | string              | NA    |
| location      | A name for the location at the hospital                  | string              | NA    |
| indicator     | Air quality parameteres                                  | string              | NA    |
| value         | Air quality measurement                                  | numeric             | ug/m3 |

# Data transformation

```{r transform-summary}

dat_in_sum_day <- dat_in %>% 
  mutate(date = as_date(date_time)) %>% 
  group_by(date, location, indicator) %>% 
  summarise(min = min(value),
            median = median(value),
            mean = mean(value),
            sd = sd(value),
            max = max(value))


```

# Data visualisation

```{r plot-daily-avg, fig.cap="Figure caption me!", fig.height=18, fig.width=10}
dat_in_sum_day %>% 
  ggplot(aes(x = date, y = mean, group = indicator, color = indicator)) +
  geom_point(size = 0.6) +
  geom_line() +
  labs(title = "Hospital Air Quality",
       subtitle = "Average 24-hour PM2.5 and PM10 concentrations at eight locations",
       x = NULL) +
  xlab(bquote(uq/m^3)) +
  facet_wrap(~location) +
  theme_bw(base_size = 12) 

```